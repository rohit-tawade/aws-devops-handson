---
- name: ðŸš€ Deploy React App to EC2
  hosts: web
  become: yes

  vars:
    app_dir: /home/ec2-user/app

  tasks:
    - name: Update all packages
      yum:
        name: '*'
        state: latest

    - name: Install Node.js and npm
      yum:
        name: nodejs
        state: present

    - name: Install Git
      yum:
        name: git
        state: present

    - name: Clone the frontend app from GitHub
      git:
        repo: 'https://github.com/rohit-tawade/aws-devops-handson.git'
        dest: "{{ app_dir }}"
        version: main
        force: yes

    - name: Install npm dependencies
      npm:
        path: "{{ app_dir }}/frontend"
        production: yes

    - name: Start React app in background
      shell: |
        cd {{ app_dir }}/frontend
        nohup npm start &
      args:
        chdir: "{{ app_dir }}/frontend"
